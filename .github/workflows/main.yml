name: CI/CD Discord Bot (TOB)
on:
  push:
    branches:
    - "**"
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the Docker image
        run: docker build -t tob .
      - name: Run the docker repo
        run: docker run --name ci_container -itd tob
      - name: See if the container is executing
        run: docker ps
      - name: Test our functions
        run: docker exec ci_container npm test
  deploy:
    runs-on: ubuntu-latest
      - name: Run Ansible playbook
        uses: dawidd6/action-ansible-playbook@v2.2.0
          with:
          playbook: deploy.yml
            directory: ./
            key: ${{secrets.azure}}
            inventory: |
              [tob_azure]
              51.103.117.57

            vault_password: ${{secrets.VAULT_PASSWORD}}
            options: |
              --limit group1
              --extra-vars hello=there
              --verbose