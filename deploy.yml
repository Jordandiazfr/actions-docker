# Install system apt packages
- hosts: tob_azure
  become: yes
  become_method: sudo
  tasks:
    - name: Install Git
      apt: name=git state=latest

    - name: clean the bot
      shell: rm -rf /home/tob/discord_bot

# CLONE THE REPO
- hosts: webservers
  become: yes
  tasks:
    - name: clone repo
      git:
        repo: "https://github.com/{{ github_user }}/{{ app_name }}.git"
        dest: /home/{{ ansible_ssh_user }}/{{ app_name }}
        update: yes # Does a git pull if the repo already exists
        force: yes

    - name: Add Docker GPG apt Key
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present

    - name: Update apt and install docker.io
      apt: update_cache=yes name=docker.io state=latest

    - name: Go to the folder and execute docker-compose
      shell: docker-ps
